---
// Generamos la misma versión de caché
const cacheBuster = `?v=${Date.now()}`;
const videoUrl = "https://res.cloudinary.com/cloudinary-autoshn/video/upload/q_auto,f_auto,vc_auto/v1764049277/bg-boda_cxx3sq.mp4";
---

<div class="absolute inset-0 w-full h-full overflow-hidden bg-black z-0">
  
  <video 
    id="hero-video"
    autoplay 
    loop 
    muted 
    playsinline 
    preload="auto"
    class="absolute inset-0 w-full h-full object-cover z-10"
  >
    <source src={videoUrl + cacheBuster} type="video/mp4" />
  </video>

  <div class="absolute inset-0 bg-black/40 z-20"></div>
</div>

<script>
  const video = document.getElementById('hero-video') as HTMLVideoElement;

  if (video) {
    // Forzamos carga inmediata
    video.load();
    
    const attemptPlay = () => {
      video.muted = true; // Requisito obligatorio para autoplay
      video.play().catch(err => {
        console.error("Intento de autoplay fallido:", err);
      });
    };

    // Intento inmediato
    attemptPlay();

    // Intentos de respaldo por si el navegador es lento
    video.addEventListener('loadeddata', attemptPlay);
    
    // Último recurso: Click en cualquier lado arranca el video
    document.addEventListener('click', attemptPlay, { once: true });
    document.addEventListener('touchstart', attemptPlay, { once: true });
  }
</script>